#################################
#         Backend & Core        #
#################################

backend = "glx";
vsync = true;
use-damage = true;
unredir-if-possible = false;
log-level = "warn";

#################################
#          Detection            #
#################################

mark-wmwin-focused = true;
mark-ovredir-focused = true;
detect-rounded-corners = true;
detect-client-opacity = true;
detect-transient = true;
detect-client-leader = true;
use-ewmh-active-win = true;

#################################
#         GLX Settings          #
#################################

glx-no-stencil = true;
glx-copy-from-front = false;
xrender-sync-fence = true;

#################################
#            Shadows            #
#################################

shadow = true;
shadow-radius = 32;
shadow-offset-x = -30;
shadow-offset-y = -30;
shadow-opacity = 0.45;

shadow-color = "#111111";
shadow-exclude = [
  "name *= 'Dunst'",
  "class_g ?= 'Notify-osd'",
  "name *= 'picom'",
  "QTILE_INTERNAL = 1"
];

#################################
#            Opacity            #
#################################

active-opacity = 1.0;
inactive-opacity = 1.0;
frame-opacity = 1.0;
inactive-dim = 0.12;
inactive-opacity-override = false;
fullscreen-opacity = 1.0;

#################################
#         Rounded Corners       #
#################################

corner-radius = 4;
round-borders = 1;

rounded-corners-exclude = [
  "window_type = 'dock'",
  "window_type = 'desktop'",
  "class_g = 'dmenu'",
  "class_g = 'dwm'"
];

#################################
#              Blur             #
#################################

blur-method = "dual_kawase";
blur-strength = 7;
blur-size = 6;
blur-deviation = 0.6;

blur-background = true;
blur-background-frame = true;
blur-background-fixed = false;

blur-background-exclude = [
  "window_type = 'dock'",
  "window_type = 'desktop'",
  "class_g = 'dmenu'",
  "class_g = 'slop'",
  "class_g = 'flameshot'",  
  "QTILE_INTERNAL:32c = 1"
];

#################################
#             Fading            #
#################################

fading = true;
fade-in-step = 0.035;
fade-out-step = 0.035;
fade-delta = 10;

#################################
#          Animations v12+      #
#################################

animations = (
  # --- Window Open ---
{
  triggers = ["open", "show"];

  opacity = {
    curve = "cubic-bezier(0.05, 0.9, 0.1, 1.0)";
    duration = 0.12;
    start = 0.0;
    end = "window-raw-opacity";
  };

  scale-x = {
    curve = "cubic-bezier(0.25, 0.1, 0.25, 1.0)";
    duration = 0.22;
    start = 0.88;
    end = 1.0;
  };

  scale-y = "scale-x";

  # ðŸ‘‡ THIS is the missing sauce
  offset-x = "(1 - scale-x) / 2 * window-width";
  offset-y = "(1 - scale-y) / 2 * window-height";

  shadow-opacity = "opacity";
  shadow-offset-x = "offset-x";
  shadow-offset-y = "offset-y";
  blur-opacity = 1.0;
},

  # --- Window Close ---
  {
    triggers = ["close", "hide"];
    opacity = {
      curve = "cubic-bezier(0.4, 0, 1, 1)";
      duration = 0.18;
      start = "window-raw-opacity-before";
      end = 0.0;
    };
    scale-x = {
      curve = "cubic-bezier(0.4, 0, 1, 1)";
      duration = 0.18;
      start = 1.0;
      end = 0.97;
    };
    scale-y = "scale-x";
    shadow-opacity = "opacity";
    blur-opacity = 0.0;
  }
);

#################################
#              Rules            #
#################################

rules = (
  # Default
  { match = "name = '*'"; opacity = 1.0; },

  # No shadow / blur junk
  { match = "window_type = 'dock'"; shadow = false; blur-background = false; corner-radius = 0; },
  { match = "window_type = 'desktop'"; shadow = false; blur-background = false; corner-radius = 0; },
  { match = "window_type = 'dnd'"; shadow = false; },

  # Tooltips
  {
    match = "window_type = 'tooltip'";
    shadow = false;
    fade = true;
    opacity = 1.0;
  },

  # Menus
  {
    match = "window_type = 'popup_menu' || window_type = 'dropdown_menu'";
    opacity = 0.96;
  },

  # Kill animations on launchers
  {
    match = "class_g = 'dmenu'";
    animations = ( { triggers = ["open", "show"]; duration = 0; } );
  }
);

